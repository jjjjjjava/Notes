# IP数据包结构

![image-20230915143427986](C:\Users\jjjjjjava\AppData\Roaming\Typora\typora-user-images\image-20230915143427986.png)

1. 版本4位，表示版本号，目前最广泛的是4=B1000，即常说的IPv4
2. 头长4位，数据包头部长度。它表示数据包头部包括多少个32位长整型，也就是多少个4字节的数据。无选项则为5（红色部分）。
3. 服务类型，包括8个二进制位，每个位的意义如下：

```
    ​    过程字段：3位，设置了数据包的重要性，取值越大数据越重要，取值范围为：0（正常）~ 7（网络控制）

    ​    延迟字段：1位，取值：0（正常）、1（期特低的延迟）

    ​    流量字段：1位，取值：0（正常）、1（期特高的流量）

    ​    可靠性字段：1位，取值：0（正常）、1（期特高的可靠性）

    ​    成本字段：1位，取值：0（正常）、1（期特最小成本）

    ​    保留字段：1位 ，未使用
```

4. 包裹总长16位，当前数据包的总长度，单位是字节。当然最大只能是65535，及64KB。

5. 重组标识16位，发送主机赋予的标识，以便接收方进行分片重组。

6. 标志3位，他们各自的意义如下：

   ```
       保留段位(2)：1位，未使用
   
   ​    不分段位(1)：1位，取值：0（允许数据报分段）、1（数据报不能分段）
   
   ​    更多段位(0)：1位，取值：0（数据包后面没有包，该包为最后的包）、1（数据包后面有更多的包）
   ```

   

7. 段偏移量13位，与更多段位组合，帮助接收方组合分段的报文，以字节为单位。

8. 生存时间8位，经常ping命令看到的TTL（Time To Live）就是这个，每经过一个路由器，该值就减一，到零丢弃。

9. 协议代码8位，表明使用该包裹的上层协议，如TCP=6，ICMP=1，UDP=17等。

10. 头检验和16位，是IPv4数据包头部的校验和。

11. 源始地址，32位4字节，我们常看到的IP是将每个字节用点（.）分开，如此而已。

12. 目的地址，32位，同上。

13. 可选选项，主要是给一些特殊的情况使用，往往安全路由会当作攻击而过滤掉，普联（TP_LINK）的TL-ER5110路由就能这么做。

14. 用户数据。