[toc]

## I2C作用

### 智能手机

- **传感器**：智能手机中的多种传感器（如加速度计、陀螺仪、环境光传感器等）通常通过I2C总线与主处理器连接。
- **电源管理**：智能手机的电源管理模块也可能通过I2C与处理器通信，以监控电池状态和控制电源分配。

### 笔记本电脑

- **温度传感器**：用于监控CPU和GPU温度的传感器可能使用I2C总线。
- **扩展端口**：如USB控制器等，可能通过I2C与主板上的主处理器通信。

### 总结

主要是负责传感器等低速设备和主处理器通信，I2C总线简单，节省PCB空间，降低设计成本。



## 主要特点

1. **两线制**: I2C总线仅使用两条线路，一条是时钟线（SCL），另一条是数据线（SDA）。
2. **多主控模式**: I2C支持多个主设备（即可以控制总线的设备）。
3. **地址分配**: 每个I2C设备都有一个独特的地址，这使得多个设备可以共享同一个总线。



### 多主控模式（Multi-Mastering）：

在I2C通信中，多主控模式允许多个主设备（通常是微控制器或处理器）共享同一总线。这意味着多个主设备可以管理总线上的通信，但在任何给定时间内，只能有一个主设备控制总线。

#### 举例说明：

假设一个系统中有两个主设备：主设备A和主设备B，以及几个从设备（如传感器、存储器等）。

1. **主设备A开始通信**：主设备A可能要向一个从设备发送数据或从它那里读取数据。在这个过程中，主设备A生成时钟信号，并通过发送起始信号来控制总线。
2. **总线仲裁**：如果主设备B也试图同时控制总线（也就是说，它试图同时发送起始信号），则会发生仲裁。I2C总线设计有能力检测这种冲突，并允许一个主设备（通常是首先发送起始信号的设备）继续其通信，而另一个主设备则稍后重试。
3. **交替使用**：在主设备A完成其通信并发送结束信号后，总线变为空闲状态。此时，主设备B可以开始它的通信。

通过这种方式，I2C总线允许多个主设备有序地共享总线，而不会干扰彼此的通信。



### 地址分配：

I2C总线上的每个设备（包括主设备和从设备）都有一个唯一的地址。这些地址用于在通信过程中识别和选择特定的从设备。

#### 举例说明：

假设有一个I2C网络，其中包括一个主设备和三个从设备：从设备X、从设备Y和从设备Z。

- **地址分配**：每个从设备被分配一个唯一的地址。例如，从设备X可以被分配地址0x10，从设备Y可以被分配地址0x11，从设备Z可以被分配地址0x12。
- **选择从设备进行通信**：
  1. 当主设备想要与从设备X通信时，它会在总线上发送从设备X的地址（0x10）。
  2. 从设备X识别到这个地址与自己的地址匹配，因此它响应主设备的请求，开始通信。
  3. 同理，如果主设备想要与从设备Y或Z通信，它会发送相应的地址（0x11或0x12）。

通过这种方式，主设备可以准确地选择与特定从设备进行通信，而无需影响总线上的其他设备。





## 工作原理

### SDA和SCL线

- **SDA（串行数据线）**: 是双向的，用于在I2C设备之间发送和接收数据。
- **SCL（串行时钟线）**: 也是双向的，由主设备控制，用于同步所有设备上的数据传输。

### 控制信号

- **起始信号**: 当SCL为高电平时，SDA线从高电平跳变到低电平，这标志着数据传输的开始。

- **结束信号**: 当SCL为高电平时，SDA线从低电平跳变到高电平，这表示数据传输的结束。

- 应答信号 (ACK/NACK)

  :

  - 在接收到8位数据后，接收器通过SDA发送一个应答信号。
  - 有效应答（ACK）是在第9个时钟脉冲的低电平期间将SDA拉低，表示接收器已成功接收数据。
  - 非应答（NACK）是SDA保持高电平，表示数据未成功接收。

### 数据传输

- 在主设备开始通信前，它首先发送一个包含从设备地址和读/写标志的字节。地址通常是7位，最后一位是读写标志位。
- 数据传输是按字节进行的，从最高有效位（MSB）开始。
- 在每个字节传输后，接收方在SCL的下一个上升沿前发出ACK或NACK。



## 其它概念

### I2C控制器

I2C控制器是一个硬件单元，通常集成在微控制器或处理器内部，用来实现I2C通信协议的功能。I2C控制器负责生成必要的信号来与I2C总线上的设备进行通信，包括产生时钟信号、读写数据、处理应答信号等。它允许CPU通过编程方式与连接到I2C总线的各种设备（如传感器、存储器等）进行交互。

### 支持的通道

在I2C控制器的上下文中，"通道"通常指的是单个I2C控制器内的独立I2C总线接口。一个I2C控制器可能支持多个通道，意味着它能够管理多个独立的I2C总线。每个通道都能够独立地与连接到相应I2C总线上的设备进行通信。通过支持多个通道，一个控制器能够同时管理多个I2C总线上的通信，这在需要与大量I2C设备通信的复杂系统中非常有用。

例如，如果一个I2C控制器有两个支持的通道，它可能能够同时管理两组设备，每组设备都连接到不同的I2C总线上。这些通道在硬件层面是分开的，每个都有自己的SCL（时钟线）和SDA（数据线），因此能够并行工作，不会互相干扰。在驱动层面，软件需要能够区分和管理这些通道，以便正确地向它们发送指令和数据。



### 适配器，控制器，通道，设备

1. **I2C适配器**:
   - I2C适配器通常是指软件层面的一个抽象，它提供了与I2C控制器交互的一组接口。在某些实现中，一个适配器可能对应一个物理的I2C控制器。
2. **I2C控制器**:
   - I2C控制器是指实际的硬件设备，负责在I2C总线上发送和接收数据。控制器执行I2C协议，生成必要的时钟信号，控制数据传输等。
3. **I2C通道**:
   - 在某些硬件中，一个I2C控制器可以支持多个通道。这里的"通道"可能指的是控制器能够管理的不同的I2C总线接口。但在许多简单的系统中，一个I2C控制器通常只有一个"通道"。
4. **I2C设备**:
   - I2C设备是指连接到I2C总线的任何外设，如传感器、存储器等。每个设备在总线上有一个唯一的地址。

所以，如果我们要概括这些术语的一般关系，可以这样说：

- 一个**I2C适配器**在软件层面通常对应一个**I2C控制器**（硬件）。
- 一个**I2C控制器**可能有一个或多个**通道**，尽管在很多情况下，尤其是在简单的嵌入式系统中，控制器只有一个通道。
- 每个**I2C通道**可以与多个**I2C设备**通信，每个设备有一个唯一的地址。

possible_position

## SylixOS I2C总线框架分析