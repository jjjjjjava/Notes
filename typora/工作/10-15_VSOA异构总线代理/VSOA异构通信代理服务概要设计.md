[toc]

## 需求概述

在串口组网或者can总线组网中使用VSOA进行跨服务通信



## 应用层

### 服务物理部署图

"服务物理部署图" 是指将系统中的各种服务、服务器、硬件设备和网络组件的物理布局和关系可视化表示的图表或图形。

![1280X1280](C:\Users\jjjjjjava\Nutstore\1\我的坚果云\typora\typora-pic\1280X1280.PNG)

#### 角色

1. 这里有两个网络域，分别是region A和region B，两个网络域之间通过串口/CAN连接，网络域内部通过以太网访问。

2. 这里有4类角色

   1. 客户端/服务端：region A网络域中有A1，B1，C1节点，region B网络中有A2，B2，C2节点。

   2. 位置服务器：position；提供位置服务功能，存有路由表，记录本网络域内节点地址，以及其它网络域的中的节点的名称，访问方式（代理服务器监听的端口号（用于监听来自总线的数据），总线名）

   3. 代理服务器：proxy，负责将本网络域内节点的网络数据转化为总线数据发送到其它网络域内的代理服务器中，再经由其它网络域内的代理服务器，达到不同网络域中节点相互通信的功能。

      猜测：来自总线的数据会转化为网络数据，然后proxy通过端口号即可监听到。proxy也可以通过这个端口号，发送数据（要把网络数据转化为总线数据）。

   4. 总线：实际起到沟通不同网络域的作用。



#### 说明

proxy服务中定义了各个节点做的服务总配置表，包括本机服务，代理服务等，可起到代替position服务的作用，格式如下：

```JSON
{
    
   "local_server": [ // 本地服务列表，描述本地节点的地址信息
      {
           "server": "A1",
           "host": "127.0.0.1",
           "port": 1234
      }
  ],
    
    
   "proxy_server": [ // 代理服务列表，描述其它网络域中节点的访问路径
      {
           "name": "A2",	//A2节点
           "local_port": 10001,	//经由代理服务器监听的10001端口
           "proxy_name": "com0",//发送到总线com0上
           "station_no": 0	//站点编号，实际上是设备编号，总线通常用于连接多个设备或节点，每个节点都有一个唯一的站点编号
      }
  ],
    
    
    
   "proxy_bus": [ // 代理总线连接方式
      {
           "name": "com0",	//总线名称
           "type": "232",	//总线协议类型，这里是 "232"，表示使用RS-232串口协议。
           "connection": {	//总线连接参数
               "interface": "ttyUSB0",	//连接的物理接口名称
               "baud_rate": 115200,	//波特率
               "data_bits": 7,	//数据位数，一次可发送7bit
               "parity": 1,	//校验位，表示奇校验
               "stop_bit": 0	//停止位
          }
      },
      {
           "name": "can0",
           "type": "can",
           "connection": {
               "interface": "can0",
               "baud_rate": 500000,
               "station_no": 1
          }
      }
  ]
}
```